const DARK_MODE_KEY = 'dark_mode_enabled';function applyDarkMode(isDarkMode) {    if (isDarkMode) document.body.classList.add('dark-mode');    else document.body.classList.remove('dark-mode');    const toggles = document.querySelectorAll('.toggle-off, #darkModeToggle');    toggles.forEach(t => {        if (isDarkMode) {            t.classList.add('active');            t.setAttribute('aria-pressed', 'true');        } else {            t.classList.remove('active');            t.setAttribute('aria-pressed', 'false');        }    });    localStorage.setItem(DARK_MODE_KEY, isDarkMode ? 'true' : 'false');}function toggleDarkMode(event) {    if (event && event.stopPropagation) event.stopPropagation();    const isDarkMode = !document.body.classList.contains('dark-mode');    applyDarkMode(isDarkMode);}window.addEventListener('storage', (event) => {    if (event.key === DARK_MODE_KEY) {        const isDarkMode = event.newValue === 'true';        applyDarkMode(isDarkMode);    }});function initDarkMode() {    const stored = localStorage.getItem(DARK_MODE_KEY);    const isDarkMode = stored === 'true';    applyDarkMode(isDarkMode);    const toggles = document.querySelectorAll('.toggle-off, #darkModeToggle');    toggles.forEach(t => {        if (!t.getAttribute('role')) t.setAttribute('role', 'button');        if (!t.hasAttribute('tabindex')) t.setAttribute('tabindex', '0');        t.removeEventListener('click', toggleDarkMode);        t.addEventListener('click', toggleDarkMode);        t.removeEventListener('keydown', toggleKeyHandler);        t.addEventListener('keydown', toggleKeyHandler);    });    console.log('Dark mode initialized, current state:', localStorage.getItem(DARK_MODE_KEY));}function toggleKeyHandler(e) {    if (e.key === 'Enter' || e.key === ' ') {        e.preventDefault();        toggleDarkMode(e);    }}document.addEventListener('DOMContentLoaded', initDarkMode);
